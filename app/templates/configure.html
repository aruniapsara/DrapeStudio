{% extends "base.html" %}

{% block title %}Configure Model â€” DrapeStudio{% endblock %}

{% block content %}
<section class="page-section">
    <h2>Step 2: Configure Virtual Model &amp; Scene</h2>

    <form id="configure-form" action="/review" method="get">

        <!-- Hidden fields populated from sessionStorage by JS below -->
        <input type="hidden" id="product_type" name="product_type" value="clothing">
        <input type="hidden" id="model_photo_url" name="model_photo_url" value="">

        <div class="form-grid">
            <!-- Model Appearance -->
            <fieldset class="form-group">
                <legend>Model Appearance</legend>

                <label for="age_range">Age Range</label>
                <select id="age_range" name="age_range" required>
                    <option value="">Select...</option>
                    <option value="18-24">18-24</option>
                    <option value="25-34">25-34</option>
                    <option value="35-44">35-44</option>
                    <option value="45+">45+</option>
                </select>

                <label for="gender_presentation">Gender</label>
                <select id="gender_presentation" name="gender_presentation" required>
                    <option value="">Select...</option>
                    <option value="feminine">Female</option>
                    <option value="masculine">Male</option>
                    <option value="neutral">Unisex</option>
                </select>

                <label for="ethnicity">Ethnicity</label>
                <select id="ethnicity" name="ethnicity" required>
                    <option value="">Select...</option>
                    <option value="sri_lankan">Sri Lankan</option>
                    <option value="indian">Indian</option>
                    <option value="middle_eastern">Middle Eastern</option>
                    <option value="african">African</option>
                    <option value="european">European</option>
                </select>

                <label for="skin_tone">Skin Tone (Fitzpatrick Scale)</label>
                <select id="skin_tone" name="skin_tone" required>
                    <option value="">Select...</option>
                    <option value="1">1 - Very Light</option>
                    <option value="2">2 - Light</option>
                    <option value="3">3 - Medium Light</option>
                    <option value="4">4 - Medium Dark</option>
                    <option value="5">5 - Dark</option>
                    <option value="6">6 - Very Dark</option>
                </select>

                <label for="hair_style">Hair Style</label>
                <select id="hair_style" name="hair_style" required>
                    <option value="">Select gender first...</option>
                </select>

                <label for="hair_color">Hair Color</label>
                <select id="hair_color" name="hair_color" required>
                    <option value="">Select...</option>
                    <option value="black">Black</option>
                    <option value="dark_brown">Dark Brown</option>
                    <option value="medium_brown">Medium Brown</option>
                    <option value="light_brown">Light Brown / Caramel</option>
                    <option value="blonde">Blonde</option>
                    <option value="auburn">Red / Auburn</option>
                    <option value="grey">Grey / Silver</option>
                </select>

                <label>Body Type</label>
                <div class="radio-group">
                    <label><input type="radio" name="body_type" value="petite" required> Petite</label>
                    <label><input type="radio" name="body_type" value="average"> Average</label>
                    <label><input type="radio" name="body_type" value="athletic"> Athletic</label>
                    <label><input type="radio" name="body_type" value="curvy"> Curvy</label>
                    <label><input type="radio" name="body_type" value="plus"> Plus</label>
                </div>

                <label for="additional_description">Additional Description <span class="label-hint">(optional)</span></label>
                <textarea
                    id="additional_description"
                    name="additional_description"
                    rows="3"
                    maxlength="300"
                    placeholder="e.g. wearing glasses, tall slim build, visible tattoos on forearms, confident expression..."
                ></textarea>
                <p class="field-hint">Anything extra the AI should know about the model. Max 300 characters.</p>
            </fieldset>

            <!-- Scene Settings -->
            <fieldset class="form-group">
                <legend>Scene Settings</legend>

                <label for="environment">Environment</label>
                <select id="environment" name="environment" required>
                    <option value="">Select...</option>
                    <option value="studio_white">Studio - White</option>
                    <option value="studio_beige">Studio - Beige</option>
                    <option value="outdoor_street">Outdoor - Street</option>
                    <option value="outdoor_park">Outdoor - Park</option>
                    <option value="outdoor_beach">Outdoor - Beach</option>
                    <option value="indoor_cafe">Indoor - Cafe</option>
                    <option value="indoor_home">Indoor - Home</option>
                </select>

                <label for="pose_preset">Pose</label>
                <select id="pose_preset" name="pose_preset" required>
                    <option value="">Select...</option>
                    <option value="front_standing">Front Standing</option>
                    <option value="walking">Walking</option>
                    <option value="three_quarter">Three-Quarter Turn</option>
                    <option value="seated">Seated</option>
                </select>

                <label for="framing">Framing</label>
                <select id="framing" name="framing" required>
                    <option value="">Select...</option>
                    <option value="full_body">Full Body</option>
                    <option value="three_quarter">Three-Quarter</option>
                    <option value="waist_up">Waist Up</option>
                </select>
            </fieldset>
        </div>

        <!-- Model Measurements (optional) -->
        <fieldset class="form-group measurements-fieldset">
            <legend>Model Measurements <span class="label-hint">(optional)</span></legend>
            <p class="field-hint" style="margin-bottom:1rem">
                Leave any field blank if unknown. Measurements help the AI match the correct fit.
            </p>
            <div class="measurements-grid">
                <div class="measure-field">
                    <label for="m_height_cm">Height (cm)</label>
                    <input type="number" id="m_height_cm" name="m_height_cm"
                           min="100" max="220" step="1" placeholder="e.g. 170">
                </div>
                <div class="measure-field">
                    <label for="m_weight_kg">Weight (kg)</label>
                    <input type="number" id="m_weight_kg" name="m_weight_kg"
                           min="30" max="200" step="0.5" placeholder="e.g. 65">
                </div>
                <div class="measure-field">
                    <label for="m_chest_bust_cm">Chest / Bust (cm)</label>
                    <input type="number" id="m_chest_bust_cm" name="m_chest_bust_cm"
                           min="60" max="160" step="1" placeholder="e.g. 90">
                </div>
                <div class="measure-field">
                    <label for="m_waist_cm">Waist (cm)</label>
                    <input type="number" id="m_waist_cm" name="m_waist_cm"
                           min="50" max="150" step="1" placeholder="e.g. 70">
                </div>
                <div class="measure-field">
                    <label for="m_hips_cm">Hips (cm)</label>
                    <input type="number" id="m_hips_cm" name="m_hips_cm"
                           min="60" max="170" step="1" placeholder="e.g. 95">
                </div>
                <div class="measure-field">
                    <label for="m_inseam_cm">Inseam (cm)</label>
                    <input type="number" id="m_inseam_cm" name="m_inseam_cm"
                           min="50" max="110" step="1" placeholder="e.g. 78">
                </div>
                <div class="measure-field">
                    <label for="m_shoe_size_eu">Shoe Size (EU)</label>
                    <input type="number" id="m_shoe_size_eu" name="m_shoe_size_eu"
                           min="30" max="52" step="0.5" placeholder="e.g. 38">
                </div>
            </div>
        </fieldset>

        <div class="form-actions">
            <a href="/upload" class="btn btn-secondary">Back</a>
            <button type="submit" class="btn btn-primary">Next: Review</button>
        </div>
    </form>
</section>

<script>
    const HAIR_STYLES = {
        feminine: [
            { value: 'long_straight',  label: 'Long Straight' },
            { value: 'long_wavy',      label: 'Long Wavy' },
            { value: 'long_curly',     label: 'Long Curly' },
            { value: 'short_bob',      label: 'Short Bob' },
            { value: 'medium_layered', label: 'Medium Layered' },
            { value: 'braided',        label: 'Braided / Updo' },
        ],
        masculine: [
            { value: 'short_tapered',   label: 'Short Tapered' },
            { value: 'medium_textured', label: 'Medium Textured' },
            { value: 'buzz_cut',        label: 'Buzz Cut' },
            { value: 'slicked_back',    label: 'Slicked Back' },
            { value: 'afro_curly',      label: 'Afro / Curly' },
            { value: 'dreadlocks',      label: 'Dreadlocks' },
        ],
        neutral: [
            { value: 'short_straight', label: 'Short Straight' },
            { value: 'medium_length',  label: 'Medium Length' },
            { value: 'long_straight',  label: 'Long Straight' },
            { value: 'shaved',         label: 'Shaved' },
            { value: 'natural_curly',  label: 'Natural Curly' },
        ],
    };

    function updateHairStyles() {
        const gender = document.getElementById('gender_presentation').value;
        const sel = document.getElementById('hair_style');
        const prev = sel.value;
        sel.innerHTML = '<option value="">Select...</option>';
        const styles = HAIR_STYLES[gender];
        if (!styles) return;
        styles.forEach(function(s) {
            const opt = document.createElement('option');
            opt.value = s.value;
            opt.textContent = s.label;
            if (s.value === prev) opt.selected = true;
            sel.appendChild(opt);
        });
    }

    document.getElementById('gender_presentation').addEventListener('change', updateHairStyles);

    // Pre-fill from sessionStorage (set on upload page)
    (function() {
        const gender = sessionStorage.getItem('genderPresentation') || '';
        if (gender) document.getElementById('gender_presentation').value = gender;
        updateHairStyles();

        const productType = sessionStorage.getItem('productType') || 'clothing';
        document.getElementById('product_type').value = productType;

        const modelPhotoUrl = sessionStorage.getItem('modelPhotoUrl') || '';
        document.getElementById('model_photo_url').value = modelPhotoUrl;
    })();
</script>
{% endblock %}
